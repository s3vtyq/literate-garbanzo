(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,48256,t=>{"use strict";let e=(0,t.i(75254).default)("globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]]);t.s(["Globe",()=>e],48256)},88699,t=>{"use strict";let e=(0,t.i(75254).default)("pencil",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}],["path",{d:"m15 5 4 4",key:"1mk7zo"}]]);t.s(["Pencil",()=>e],88699)},61086,t=>{"use strict";let e=(0,t.i(75254).default)("loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);t.s(["Loader",()=>e],61086)},49567,t=>{"use strict";var e=t.i(932),o=t.i(66027),r=t.i(97621),a=t.i(75157);function u(){let t,r=(0,e.c)(1);return r[0]===Symbol.for("react.memo_cache_sentinel")?(t={queryKey:["stats","daily"],queryFn:i,select:n,refetchInterval:36e5,refetchOnMount:"always"},r[0]=t):t=r[0],(0,o.useQuery)(t)}function n(t){return t.map(s)}function s(t){return{input_token:(0,a.formatCount)(t.input_token),output_token:(0,a.formatCount)(t.output_token),total_token:(0,a.formatCount)(t.input_token+t.output_token),input_cost:(0,a.formatMoney)(t.input_cost),output_cost:(0,a.formatMoney)(t.output_cost),total_cost:(0,a.formatMoney)(t.input_cost+t.output_cost),wait_time:(0,a.formatTime)(t.wait_time),request_success:(0,a.formatCount)(t.request_success),request_failed:(0,a.formatCount)(t.request_failed),request_count:(0,a.formatCount)(t.request_success+t.request_failed),date:t.date}}async function i(){return r.apiClient.get("/api/v1/stats/daily")}function c(){let t,r=(0,e.c)(1);return r[0]===Symbol.for("react.memo_cache_sentinel")?(t={queryKey:["stats","hourly"],queryFn:p,select:l,refetchInterval:1e4,refetchOnMount:"always"},r[0]=t):t=r[0],(0,o.useQuery)(t)}function l(t){return t.map(f)}function f(t){return{hour:t.hour,date:t.date,input_token:(0,a.formatCount)(t.input_token),output_token:(0,a.formatCount)(t.output_token),total_token:(0,a.formatCount)(t.input_token+t.output_token),input_cost:(0,a.formatMoney)(t.input_cost),output_cost:(0,a.formatMoney)(t.output_cost),total_cost:(0,a.formatMoney)(t.input_cost+t.output_cost),wait_time:(0,a.formatTime)(t.wait_time),request_success:(0,a.formatCount)(t.request_success),request_failed:(0,a.formatCount)(t.request_failed),request_count:(0,a.formatCount)(t.request_success+t.request_failed)}}async function p(){return r.apiClient.get("/api/v1/stats/hourly")}function _(){let t,r=(0,e.c)(1);return r[0]===Symbol.for("react.memo_cache_sentinel")?(t={queryKey:["stats","total"],queryFn:y,select:m,refetchInterval:1e4,refetchOnMount:"always"},r[0]=t):t=r[0],(0,o.useQuery)(t)}function m(t){return{input_token:(0,a.formatCount)(t.input_token),output_token:(0,a.formatCount)(t.output_token),total_token:(0,a.formatCount)(t.input_token+t.output_token),input_cost:(0,a.formatMoney)(t.input_cost),output_cost:(0,a.formatMoney)(t.output_cost),total_cost:(0,a.formatMoney)(t.input_cost+t.output_cost),wait_time:(0,a.formatTime)(t.wait_time),request_success:(0,a.formatCount)(t.request_success),request_failed:(0,a.formatCount)(t.request_failed),request_count:(0,a.formatCount)(t.request_success+t.request_failed)}}async function y(){return r.apiClient.get("/api/v1/stats/total")}function h(){let t,r=(0,e.c)(1);return r[0]===Symbol.for("react.memo_cache_sentinel")?(t={queryKey:["stats","apikey"],queryFn:k,select:g,refetchInterval:3e4,refetchOnMount:"always"},r[0]=t):t=r[0],(0,o.useQuery)(t)}function g(t){return t.map(d)}function d(t){return{api_key_id:t.api_key_id,input_token:(0,a.formatCount)(t.input_token),output_token:(0,a.formatCount)(t.output_token),total_token:(0,a.formatCount)(t.input_token+t.output_token),input_cost:(0,a.formatMoney)(t.input_cost),output_cost:(0,a.formatMoney)(t.output_cost),total_cost:(0,a.formatMoney)(t.input_cost+t.output_cost),wait_time:(0,a.formatTime)(t.wait_time),request_success:(0,a.formatCount)(t.request_success),request_failed:(0,a.formatCount)(t.request_failed),request_count:(0,a.formatCount)(t.request_success+t.request_failed)}}async function k(){return r.apiClient.get("/api/v1/stats/apikey")}t.s(["useStatsAPIKey",()=>h,"useStatsDaily",()=>u,"useStatsHourly",()=>c,"useStatsTotal",()=>_])},25165,t=>{"use strict";var e=t.i(932),o=t.i(69230),r=t.i(92571),a=class extends o.QueryObserver{constructor(t,e){super(t,e)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(t){super.setOptions({...t,behavior:(0,r.infiniteQueryBehavior)()})}getOptimisticResult(t){return t.behavior=(0,r.infiniteQueryBehavior)(),super.getOptimisticResult(t)}fetchNextPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(t){return this.fetch({...t,meta:{fetchMore:{direction:"backward"}}})}createResult(t,e){let{state:o}=t,a=super.createResult(t,e),{isFetching:u,isRefetching:n,isError:s,isRefetchError:i}=a,c=o.fetchMeta?.fetchMore?.direction,l=s&&"forward"===c,f=u&&"forward"===c,p=s&&"backward"===c,_=u&&"backward"===c;return{...a,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:(0,r.hasNextPage)(e,o.data),hasPreviousPage:(0,r.hasPreviousPage)(e,o.data),isFetchNextPageError:l,isFetchingNextPage:f,isFetchPreviousPageError:p,isFetchingPreviousPage:_,isRefetchError:i&&!l&&!p,isRefetching:n&&!f&&!_}}},u=t.i(69637),n=t.i(54616),s=t.i(12598),i=t.i(97621),c=t.i(78497),l=t.i(71645);function f(){let t,o=(0,e.c)(2),r=(0,s.useQueryClient)();return o[0]!==r?(t={mutationFn:_,onSuccess:()=>{c.logger.log("日志清空成功"),r.invalidateQueries({queryKey:["logs"]})},onError:p},o[0]=r,o[1]=t):t=o[1],(0,n.useMutation)(t)}function p(t){c.logger.error("日志清空失败:",t)}async function _(){return i.apiClient.delete("/api/v1/log/clear")}let m=t=>["logs","infinite",t];function y(t){var o;let r,n,f,p,_,y,g,d,k,q,P,v=(0,e.c)(31);v[0]!==t?(r=void 0===t?{}:t,v[0]=t,v[1]=r):r=v[1];let{pageSize:C}=r,M=void 0===C?20:C,[w,S]=(0,l.useState)(!1),[b,x]=(0,l.useState)(null),N=(0,l.useRef)(null),O=(0,s.useQueryClient)();v[2]!==M?(n=m(M),v[2]=M,v[3]=n):n=v[3],v[4]!==M?(f=async t=>{let{pageParam:e}=t,o=new URLSearchParams;return o.set("page",String(e)),o.set("page_size",String(M)),await i.apiClient.get(`/api/v1/log/list?${o.toString()}`)??[]},p=(t,e)=>{if(t&&!(t.length<M))return e.length+1},v[4]=M,v[5]=f,v[6]=p):(f=v[5],p=v[6]),v[7]!==n||v[8]!==f||v[9]!==p?(_={queryKey:n,initialPageParam:1,queryFn:f,getNextPageParam:p,staleTime:1/0,refetchOnMount:"always"},v[7]=n,v[8]=f,v[9]=p,v[10]=_):_=v[10];let Q=(o=_,(0,u.useBaseQuery)(o,a,void 0));if(v[11]!==Q.data?.pages){let t=Q.data?.pages??[],e=new Set;for(let o of(y=[],t))for(let t of o)e.has(t.id)||(e.add(t.id),y.push(t));y.sort(h),v[11]=Q.data?.pages,v[12]=y}else y=v[12];let L=y;v[13]!==Q?(g=async()=>{if(Q.hasNextPage&&!Q.isFetchingNextPage)try{await Q.fetchNextPage()}catch(t){c.logger.error("加载更多日志失败:",t)}},v[13]=Q,v[14]=g):g=v[14];let R=g;v[15]!==M||v[16]!==O?(d=()=>{let t=!1;return(async()=>{try{let{token:e}=await i.apiClient.get("/api/v1/log/stream-token");if(t)return;let o=new EventSource(`${i.API_BASE_URL}/api/v1/log/stream?token=${e}`);N.current=o,o.onopen=()=>{S(!0),x(null)},o.onmessage=t=>{try{let e=JSON.parse(t.data);O.setQueryData(m(M),t=>{if(!t)return{pages:[[e]],pageParams:[1]};if(t.pages.some(t=>t?.some(t=>t.id===e.id)))return t;let o=t.pages[0]??[];return{...t,pages:[[e,...o],...t.pages.slice(1)]}})}catch(t){c.logger.error("解析日志数据失败:",t)}},o.onerror=()=>{S(!1),x(Error("SSE 连接断开")),o.close(),N.current=null}}catch(e){if(t)return;x(e instanceof Error?e:Error("获取 stream token 失败")),c.logger.error("获取 stream token 失败:",e)}})(),()=>{t=!0,N.current?.close(),N.current=null,S(!1)}},k=[M,O],v[15]=M,v[16]=O,v[17]=d,v[18]=k):(d=v[17],k=v[18]),(0,l.useEffect)(d,k),v[19]!==M||v[20]!==O?(q=()=>{O.removeQueries({queryKey:m(M)})},v[19]=M,v[20]=O,v[21]=q):q=v[21];let F=q,K=!!Q.hasNextPage;return v[22]!==F||v[23]!==b||v[24]!==w||v[25]!==R||v[26]!==L||v[27]!==Q.isFetchingNextPage||v[28]!==Q.isLoading||v[29]!==K?(P={logs:L,isConnected:w,error:b,hasMore:K,isLoading:Q.isLoading,isLoadingMore:Q.isFetchingNextPage,loadMore:R,clear:F},v[22]=F,v[23]=b,v[24]=w,v[25]=R,v[26]=L,v[27]=Q.isFetchingNextPage,v[28]=Q.isLoading,v[29]=K,v[30]=P):P=v[30],P}function h(t,e){return e.time-t.time}t.s(["useClearLogs",()=>f,"useLogs",()=>y],25165)}]);