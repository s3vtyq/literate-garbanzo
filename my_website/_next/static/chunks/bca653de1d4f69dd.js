(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,86311,e=>{"use strict";let t=(0,e.i(75254).default)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]]);e.s(["MessageSquare",()=>t],86311)},25165,e=>{"use strict";var t=e.i(932),r=e.i(69230),a=e.i(92571),i=class extends r.QueryObserver{constructor(e,t){super(e,t)}bindMethods(){super.bindMethods(),this.fetchNextPage=this.fetchNextPage.bind(this),this.fetchPreviousPage=this.fetchPreviousPage.bind(this)}setOptions(e){super.setOptions({...e,behavior:(0,a.infiniteQueryBehavior)()})}getOptimisticResult(e){return e.behavior=(0,a.infiniteQueryBehavior)(),super.getOptimisticResult(e)}fetchNextPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"forward"}}})}fetchPreviousPage(e){return this.fetch({...e,meta:{fetchMore:{direction:"backward"}}})}createResult(e,t){let{state:r}=e,i=super.createResult(e,t),{isFetching:s,isRefetching:n,isError:o,isRefetchError:u}=i,g=r.fetchMeta?.fetchMore?.direction,c=o&&"forward"===g,l=s&&"forward"===g,h=o&&"backward"===g,f=s&&"backward"===g;return{...i,fetchNextPage:this.fetchNextPage,fetchPreviousPage:this.fetchPreviousPage,hasNextPage:(0,a.hasNextPage)(t,r.data),hasPreviousPage:(0,a.hasPreviousPage)(t,r.data),isFetchNextPageError:c,isFetchingNextPage:l,isFetchPreviousPageError:h,isFetchingPreviousPage:f,isRefetchError:u&&!c&&!h,isRefetching:n&&!l&&!f}}},s=e.i(69637),n=e.i(54616),o=e.i(12598),u=e.i(97621),g=e.i(78497),c=e.i(71645);function l(){let e,r=(0,t.c)(2),a=(0,o.useQueryClient)();return r[0]!==a?(e={mutationFn:f,onSuccess:()=>{g.logger.log("日志清空成功"),a.invalidateQueries({queryKey:["logs"]})},onError:h},r[0]=a,r[1]=e):e=r[1],(0,n.useMutation)(e)}function h(e){g.logger.error("日志清空失败:",e)}async function f(){return u.apiClient.delete("/api/v1/log/clear")}let d=e=>["logs","infinite",e];function P(e){var r;let a,n,l,h,f,P,v,y,m,x,N,S=(0,t.c)(31);S[0]!==e?(a=void 0===e?{}:e,S[0]=e,S[1]=a):a=S[1];let{pageSize:b}=a,w=void 0===b?20:b,[M,R]=(0,c.useState)(!1),[E,L]=(0,c.useState)(null),O=(0,c.useRef)(null),Q=(0,o.useQueryClient)();S[2]!==w?(n=d(w),S[2]=w,S[3]=n):n=S[3],S[4]!==w?(l=async e=>{let{pageParam:t}=e,r=new URLSearchParams;return r.set("page",String(t)),r.set("page_size",String(w)),await u.apiClient.get(`/api/v1/log/list?${r.toString()}`)??[]},h=(e,t)=>{if(e&&!(e.length<w))return t.length+1},S[4]=w,S[5]=l,S[6]=h):(l=S[5],h=S[6]),S[7]!==n||S[8]!==l||S[9]!==h?(f={queryKey:n,initialPageParam:1,queryFn:l,getNextPageParam:h,staleTime:1/0,refetchOnMount:"always"},S[7]=n,S[8]=l,S[9]=h,S[10]=f):f=S[10];let k=(r=f,(0,s.useBaseQuery)(r,i,void 0));if(S[11]!==k.data?.pages){let e=k.data?.pages??[],t=new Set;for(let r of(P=[],e))for(let e of r)t.has(e.id)||(t.add(e.id),P.push(e));P.sort(p),S[11]=k.data?.pages,S[12]=P}else P=S[12];let C=P;S[13]!==k?(v=async()=>{if(k.hasNextPage&&!k.isFetchingNextPage)try{await k.fetchNextPage()}catch(e){g.logger.error("加载更多日志失败:",e)}},S[13]=k,S[14]=v):v=S[14];let q=v;S[15]!==w||S[16]!==Q?(y=()=>{let e=!1;return(async()=>{try{let{token:t}=await u.apiClient.get("/api/v1/log/stream-token");if(e)return;let r=new EventSource(`${u.API_BASE_URL}/api/v1/log/stream?token=${t}`);O.current=r,r.onopen=()=>{R(!0),L(null)},r.onmessage=e=>{try{let t=JSON.parse(e.data);Q.setQueryData(d(w),e=>{if(!e)return{pages:[[t]],pageParams:[1]};if(e.pages.some(e=>e?.some(e=>e.id===t.id)))return e;let r=e.pages[0]??[];return{...e,pages:[[t,...r],...e.pages.slice(1)]}})}catch(e){g.logger.error("解析日志数据失败:",e)}},r.onerror=()=>{R(!1),L(Error("SSE 连接断开")),r.close(),O.current=null}}catch(t){if(e)return;L(t instanceof Error?t:Error("获取 stream token 失败")),g.logger.error("获取 stream token 失败:",t)}})(),()=>{e=!0,O.current?.close(),O.current=null,R(!1)}},m=[w,Q],S[15]=w,S[16]=Q,S[17]=y,S[18]=m):(y=S[17],m=S[18]),(0,c.useEffect)(y,m),S[19]!==w||S[20]!==Q?(x=()=>{Q.removeQueries({queryKey:d(w)})},S[19]=w,S[20]=Q,S[21]=x):x=S[21];let B=x,F=!!k.hasNextPage;return S[22]!==B||S[23]!==E||S[24]!==M||S[25]!==q||S[26]!==C||S[27]!==k.isFetchingNextPage||S[28]!==k.isLoading||S[29]!==F?(N={logs:C,isConnected:M,error:E,hasMore:F,isLoading:k.isLoading,isLoadingMore:k.isFetchingNextPage,loadMore:q,clear:B},S[22]=B,S[23]=E,S[24]=M,S[25]=q,S[26]=C,S[27]=k.isFetchingNextPage,S[28]=k.isLoading,S[29]=F,S[30]=N):N=S[30],N}function p(e,t){return t.time-e.time}e.s(["useClearLogs",()=>l,"useLogs",()=>P],25165)}]);